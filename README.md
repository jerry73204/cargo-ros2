# cargo-ros2

**Project-Centric ROS 2 Rust Bindings**

A next-generation build tool for ROS 2 Rust projects that solves the circular dependency problem and works seamlessly with system-installed ROS packages.

[![Status](https://img.shields.io/badge/status-design%20phase-yellow)]()
[![License](https://img.shields.io/badge/license-MIT%20OR%20Apache--2.0-blue)]()

---

## The Problem

Current ROS 2 Rust bindings (ros2_rust) face fundamental issues:

1. **Circular Dependency**: Cargo needs bindings before build, but bindings are generated during build
2. **System Package Incompatibility**: Can't use `apt`-installed ROS packages (they lack Rust bindings)
3. **Workspace Requirement**: Must use colcon with specific 3-stage build order
4. **Complex Setup**: Can't build standalone Rust ROS projects

## The Solution

**cargo-ros2** generates Rust bindings to `target/ros2_bindings/` *before* Cargo's dependency resolution:

```bash
# Standard Cargo.toml
[dependencies]
vision_msgs = "*"    # Works with apt-installed ros-humble-vision-msgs!
sensor_msgs = "*"

# Just build
cargo ros2 build

# Behind the scenes:
# 1. Discovers ROS packages via ament_index (finds apt-installed packages)
# 2. Generates Rust bindings to target/ros2_bindings/
# 3. Auto-patches .cargo/config.toml
# 4. Runs cargo build → Success!
```

## Key Features

- ✅ **Breaks Circular Dependency**: Bindings exist before Cargo runs
- ✅ **System Package Support**: Discovers via `ament_index` (works with apt!)
- ✅ **Standard Cargo Experience**: Normal Cargo.toml, transparent patches
- ✅ **Project-Isolated**: All artifacts in `target/`, no global state
- ✅ **Zero Configuration**: User just runs `cargo ros2 build`
- ✅ **Smart Caching**: Checksum-based incremental generation
- ✅ **colcon-Friendly**: Drop-in replacement for cargo invocations

## Project Status

**Current Phase**: Phase 0 (Design & Documentation) ✅

**Next Phase**: Phase 1 (MVP - Messages Only)

See [docs/ROADMAP.md](docs/ROADMAP.md) for detailed implementation plan.

## Documentation

- [**CLAUDE.md**](CLAUDE.md) - Project instructions for Claude AI
- [**docs/DESIGN.md**](docs/DESIGN.md) - Technical design document
- [**docs/ROADMAP.md**](docs/ROADMAP.md) - Implementation roadmap with phases

## Quick Example (Future)

```rust
// main.rs
use vision_msgs::msg::Detection3D;
use sensor_msgs::msg::PointCloud2;

fn main() {
    let detection = Detection3D {
        bbox: ...,
        score: 0.95,
        ..Default::default()
    };

    println!("Detection: {:?}", detection);
}
```

```bash
cargo ros2 build    # Just works!
cargo ros2 run
```

## Architecture

```
my_robot_project/
├── Cargo.toml                    # Standard manifest
├── .cargo/
│   └── config.toml               # Auto-generated patches
├── target/
│   ├── ros2_bindings/            # Generated by cargo-ros2
│   │   ├── vision_msgs/
│   │   │   ├── Cargo.toml
│   │   │   ├── src/lib.rs        # FFI bindings
│   │   │   └── build.rs
│   │   └── sensor_msgs/
│   └── debug/
├── .ros2_bindgen_cache           # Metadata (checksums)
└── src/
    └── main.rs
```

## Comparison

| Feature | cargo-ros2 | ros2_rust | r2r |
|---------|------------|-----------|-----|
| **Circular Dep** | ✅ Solved | ❌ Workspace only | ✅ Solved |
| **System Packages** | ✅ ament_index | ❌ Local build | ✅ ament_index |
| **Build Speed** | ✅ Cached | ✅ Pre-compiled | ❌ Regenerates all |
| **Standard Cargo** | ✅ Normal deps | ⚠️ Patches | ❌ No deps |
| **IDE Support** | ✅ rust-analyzer | ✅ rust-analyzer | ⚠️ OUT_DIR |

## Roadmap

### Phase 1: MVP (3-4 weeks)
- Message type support
- Basic caching
- `cargo ros2 build` CLI

### Phase 2: Complete (3-4 weeks)
- Services & actions
- Smart caching
- Performance optimization

### Phase 3: Production (4-5 weeks)
- colcon integration
- Multi-distro support
- Public release (0.1.0)

See [docs/ROADMAP.md](docs/ROADMAP.md) for details.

## Installation (Future)

```bash
cargo install cargo-ros2
```

## Usage (Future)

```bash
# Create project
cargo new my_robot && cd my_robot

# Add ROS dependencies (standard Cargo.toml)
cat >> Cargo.toml << EOF
[dependencies]
rclrs = "0.4"
vision_msgs = "*"
sensor_msgs = "*"
EOF

# Build (all magic happens here)
cargo ros2 build

# Run
cargo ros2 run
```

## Requirements

- ROS 2 (Humble, Iron, or Jazzy)
- Rust 1.70+
- Linux or macOS (Windows future support)

## Contributing

(To be added after initial implementation)

## Related Projects

- [ros2_rust](https://github.com/ros2-rust/ros2_rust) - Official ROS 2 Rust bindings
- [r2r](https://github.com/sequenceplanner/r2r) - Alternative Rust bindings
- [colcon-ros-cargo](https://github.com/colcon/colcon-ros-cargo) - Build system integration

## License

MIT OR Apache-2.0 (to be decided - compatible with ROS 2 ecosystem)

## Authors

- **Design Phase**: Anthropic Claude + User collaboration (2025-01)

---

**Status**: Design phase complete ✅
**Next**: Implement Phase 1 MVP
**Last Updated**: 2025-01-29
