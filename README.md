# cargo-ros2

**All-in-One Build Tool for ROS 2 Rust Projects**

A next-generation, unified build tool that solves the circular dependency problem, generates ROS bindings, builds packages, and installs to ament layout - all in one tool.

[![Status](https://img.shields.io/badge/status-design%20phase-orange)]()
[![License](https://img.shields.io/badge/license-MIT%20OR%20Apache--2.0-blue)]()

---

## The Problem

Current ROS 2 Rust development faces multiple challenges:

1. **Circular Dependency**: Cargo needs bindings before build, but bindings are generated during build
2. **System Package Incompatibility**: Can't use `apt`-installed ROS packages (they lack Rust bindings)
3. **Workspace Requirement**: Must use colcon with specific 3-stage build order
4. **Tool Fragmentation**: Multiple tools needed (cargo-ament-build, colcon-ros-cargo, custom scripts)

## The Solution

**cargo-ros2** is an all-in-one tool providing three-phase build process:

```bash
# Standard Cargo.toml
[dependencies]
rclrs = "0.4"
vision_msgs = "*"    # Works with apt-installed ros-humble-vision-msgs!
sensor_msgs = "*"

# Complete build with ament installation
cargo ros2 ament-build --install-base install/my_robot

# Behind the scenes (three phases):
# Phase 1 (Pre-build):  Generate bindings for vision_msgs, sensor_msgs
# Phase 2 (Build):      cargo build (or check for pure libs)
# Phase 3 (Post-build): Install to ament layout (binaries, source, markers)
# â†’ Success!
```

## Key Features

- ðŸŽ¯ **Solves Circular Dependency**: Bindings exist before Cargo runs
- ðŸ”§ **All-in-One Tool**: Generates bindings, builds, and installs in one command
- ðŸ“¦ **System Package Support**: Discovers via `ament_index` (works with apt!)
- ðŸš€ **Project-Isolated**: All artifacts in `target/`, no global state
- âš¡ **Smart Caching**: Checksum-based incremental generation
- ðŸ”Œ **colcon Integration**: Drop-in replacement for cargo-ament-build
- âœ… **Standard Cargo**: Normal Cargo.toml dependencies, transparent patches
- ðŸ› ï¸ **Zero Configuration**: Just run `cargo ros2 ament-build`

## Project Status

**Current Phase**: Phase 0 (Design & Documentation) âœ…

**Next Phase**: Phase 1 (MVP - Messages Only)

See [docs/ROADMAP.md](docs/ROADMAP.md) for detailed implementation plan.

## Documentation

ðŸ“– **Start here** (minimalist design docs):
- **[ARCH.md](docs/ARCH.md)** â­ - Architecture overview (two-tool design)
- **[DESIGN.md](docs/DESIGN.md)** - Implementation details
- **[ROADMAP.md](docs/ROADMAP.md)** - Phase-by-phase plan

ðŸ“š **Additional**:
- [CLAUDE.md](CLAUDE.md) - Project instructions
- [docs/archive/](docs/archive/) - Verbose design docs (historical)

## Quick Example (Future)

```rust
// main.rs
use vision_msgs::msg::Detection3D;
use sensor_msgs::msg::PointCloud2;

fn main() {
    let detection = Detection3D {
        bbox: ...,
        score: 0.95,
        ..Default::default()
    };

    println!("Detection: {:?}", detection);
}
```

```bash
cargo ros2 build    # Just works!
cargo ros2 run
```

## Architecture

```
my_robot_project/
â”œâ”€â”€ Cargo.toml                    # Standard manifest
â”œâ”€â”€ .cargo/
â”‚   â””â”€â”€ config.toml               # Auto-generated patches
â”œâ”€â”€ target/
â”‚   â”œâ”€â”€ ros2_bindings/            # Generated by cargo-ros2
â”‚   â”‚   â”œâ”€â”€ vision_msgs/
â”‚   â”‚   â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â”‚   â”‚   â”œâ”€â”€ src/lib.rs        # FFI bindings
â”‚   â”‚   â”‚   â””â”€â”€ build.rs
â”‚   â”‚   â””â”€â”€ sensor_msgs/
â”‚   â””â”€â”€ debug/
â”œâ”€â”€ .ros2_bindgen_cache           # Metadata (checksums)
â””â”€â”€ src/
    â””â”€â”€ main.rs
```

## Comparison with Existing Tools

| Feature | cargo-ros2 | ros2_rust | r2r | cargo-ament-build |
|---------|------------|-----------|-----|-------------------|
| **Circular Dep** | âœ… Solved | âŒ Workspace only | âœ… Solved | N/A (post-build only) |
| **System Packages** | âœ… ament_index | âŒ Local build | âœ… ament_index | N/A |
| **Build Speed** | âœ… Cached | âœ… Pre-compiled | âŒ Regenerates all | âœ… Fast |
| **Ament Install** | âœ… Built-in | âœ… Via colcon | Manual | âœ… Specialized tool |
| **Standard Cargo** | âœ… Normal deps | âš ï¸ Patches | âŒ No deps | âœ… Normal |
| **Standalone** | âœ… Yes | âŒ Needs workspace | âœ… Yes | âš ï¸ Needs colcon |
| **IDE Support** | âœ… rust-analyzer | âœ… rust-analyzer | âš ï¸ OUT_DIR | N/A |

**Note**: cargo-ros2 **absorbs** cargo-ament-build functionality, becoming a unified tool.

## Roadmap

### Phase 1: MVP (Weeks 1-4)
- Binding generation for messages
- Basic caching
- `cargo ros2 build` CLI

### Phase 2: Complete Feature Set (Weeks 5-9)
- Services & actions support
- Smart caching system
- **Ament installation (absorb cargo-ament-build)**
- `cargo ros2 ament-build` command

### Phase 3: Production (Weeks 10-13)
- Fork/modify colcon-ros-cargo
- Multi-distro support (Humble, Iron, Jazzy)
- IDE integration (rust-analyzer)
- Public release (0.1.0)

**Timeline**: 12-16 weeks total â€¢ See [docs/ROADMAP.md](docs/ROADMAP.md) for details.

## Installation (Future)

```bash
# Install cargo-ros2
cargo install cargo-ros2

# For colcon integration (Phase 3)
pip install colcon-ros-cargo-v2  # (our fork, or upstreamed)
```

## Usage (Future)

### Standalone Build

```bash
# Create project
cargo new my_robot && cd my_robot

# Add ROS dependencies (standard Cargo.toml)
cat >> Cargo.toml << EOF
[dependencies]
rclrs = "0.4"
vision_msgs = "*"
sensor_msgs = "*"
EOF

# Build with ament installation
cargo ros2 ament-build --install-base install/my_robot

# Verify installation
ls install/my_robot/
# lib/my_robot/         â† binaries
# share/my_robot/rust/  â† source
# share/ament_index/    â† markers
```

### colcon Integration

```bash
# Standard colcon workflow (automatic in Phase 3)
colcon build --packages-select my_rust_pkg

# Behind the scenes:
# â†’ colcon-ros-cargo detects cargo-ros2
# â†’ Invokes: cargo ros2 ament-build --install-base ...
# â†’ Everything just works!
```

## Requirements

- ROS 2 (Humble, Iron, or Jazzy)
- Rust 1.70+
- Linux or macOS (Windows future support)

## Related Projects

- **[ros2_rust](https://github.com/ros2-rust/ros2_rust)** - Official ROS 2 Rust bindings (workspace-based)
- **[r2r](https://github.com/sequenceplanner/r2r)** - Alternative Rust bindings (build.rs generation)
- **[cargo-ament-build](https://github.com/ros2-rust/cargo-ament-build)** - Ament installation tool (**being absorbed into cargo-ros2**)
- **[colcon-ros-cargo](https://github.com/colcon/colcon-ros-cargo)** - colcon plugin (will be modified to use cargo-ros2)

## Acknowledgments

- **ros2-rust team** - For the current ROS 2 Rust bindings
- **cargo-ament-build** - Inspiration and code extraction for ament installation
- **r2r** - Alternative approach to ROS 2 Rust bindings
- **colcon team** - For the extensible build system

## License

This project is licensed under either of:

- MIT License ([LICENSE-MIT](LICENSE-MIT) or http://opensource.org/licenses/MIT)
- Apache License, Version 2.0 ([LICENSE-APACHE](LICENSE-APACHE) or http://www.apache.org/licenses/LICENSE-2.0)

at your option.

This dual-licensing approach is compatible with the ROS 2 ecosystem.

## Contributing

**We welcome contributions!** However, please note the project is in the design phase.

### Current Priorities

1. **Feedback on architecture** - Review docs, provide input
2. **Community engagement** - Share with ros2-rust community
3. **Testing existing tools** - Help test cargo-ament-build, colcon-ros-cargo

### Future Contributions (Phase 1+)

Once implementation begins:
- Code contributions (Rust)
- Testing with real ROS 2 projects
- Documentation improvements
- Bug reports and feature requests

---

**Status**: Design phase complete âœ…
**Next**: Implement Phase 1 MVP
**Last Updated**: 2025-01-30
